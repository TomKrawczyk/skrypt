import React, { useState, useMemo } from 'react';
import { Phone, ChevronRight, Calculator, AlertCircle, CheckCircle, RefreshCw, MessageSquare, User, Home, DollarSign, Clock, Target } from 'lucide-react';

const InteractiveCallScript = () => {
  const [stage, setStage] = useState('start');
  const [contactType, setContactType] = useState('');
  const [clientProfile, setClientProfile] = useState('');
  const [notes, setNotes] = useState('');
  const [clientData, setClientData] = useState({
    name: '',
    propertyType: '',
    area: '',
    monthlyBill: '',
    problems: []
  });
  const [history, setHistory] = useState([]);
  const [showCalculator, setShowCalculator] = useState(false);

  // Kalkulator
  const calculations = useMemo(() => {
    const area = parseFloat(clientData.area) || 0;
    const bill = parseFloat(clientData.monthlyBill) || 0;
    
    const rekuperatorCount = area <= 80 ? 1 : area <= 120 ? 2 : area <= 180 ? 3 : 4;
    const rekuperatorCost = 2800 + (rekuperatorCount - 1) * 3200;
    const pscLiters = area * 0.33;
    const pscCost = pscLiters * 110;
    const totalKomfort = rekuperatorCost + pscCost + 2000;
    const savings = bill * 0.3;
    const annualSavings = savings * 12;
    const roi = totalKomfort / annualSavings;
    
    return {
      rekuperatorCount,
      rekuperatorCost,
      pscCost,
      totalKomfort,
      savings,
      annualSavings,
      roi
    };
  }, [clientData.area, clientData.monthlyBill]);

  const addToHistory = (action) => {
    setHistory([...history, { time: new Date().toLocaleTimeString(), action }]);
  };

  const goToStage = (newStage, action) => {
    setStage(newStage);
    if (action) addToHistory(action);
  };

  // KOMPONENTY ETAPÃ“W

  const StartScreen = () => (
    <div className="space-y-6">
      <div className="text-center">
        <Phone className="w-16 h-16 mx-auto mb-4 text-green-600" />
        <h2 className="text-3xl font-bold mb-2">Zdrowe Mieszkanie+</h2>
        <p className="text-gray-600">Interaktywny Skrypt Rozmowy</p>
      </div>

      <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
        <p className="font-semibold mb-2">ğŸ¯ Cel rozmowy:</p>
        <ul className="text-sm space-y-1">
          <li>âœ… GÅ‚Ã³wny: UmÃ³wiÄ‡ spotkanie diagnostyczne</li>
          <li>âœ… Idealny: BezpoÅ›rednie zamkniÄ™cie sprzedaÅ¼y</li>
          <li>âœ… Minimalny: PozostawiÄ‡ kontakt na przyszÅ‚oÅ›Ä‡</li>
        </ul>
      </div>

      <div className="space-y-4">
        <div>
          <label className="block font-semibold mb-2">1. Typ kontaktu:</label>
          <div className="grid grid-cols-2 gap-3">
            <button
              onClick={() => { setContactType('warm'); goToStage('profile', 'Wybrano kontakt ciepÅ‚y'); }}
              className="p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition"
            >
              <div className="font-semibold">â˜€ï¸ CiepÅ‚y</div>
              <div className="text-xs text-gray-600 mt-1">Polecenie, poprzedni kontakt</div>
            </button>
            <button
              onClick={() => { setContactType('cold'); goToStage('profile', 'Wybrano kontakt zimny'); }}
              className="p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition"
            >
              <div className="font-semibold">â„ï¸ Zimny</div>
              <div className="text-xs text-gray-600 mt-1">Baza danych, cold call</div>
            </button>
          </div>
        </div>
      </div>
    </div>
  );

  const ProfileScreen = () => (
    <div className="space-y-6">
      <h3 className="text-2xl font-bold">2. Profil Klienta</h3>
      <p className="text-gray-600">Wybierz ktÃ³ry typ klienta pasuje najbardziej (moÅ¼esz zmieniÄ‡ pÃ³Åºniej):</p>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <button
          onClick={() => { setClientProfile('family'); goToStage('opening', 'Profil: MÅ‚oda rodzina'); }}
          className="p-4 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition text-left"
        >
          <div className="font-semibold text-lg mb-2">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ MÅ‚oda Rodzina</div>
          <div className="text-sm text-gray-600">
            Dzieci z alergiÄ…, wilgoÄ‡, zapachy
            <br />
            <strong>Hak:</strong> Zdrowe powietrze dla dzieci
          </div>
        </button>

        <button
          onClick={() => { setClientProfile('senior'); goToStage('opening', 'Profil: Senior'); }}
          className="p-4 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition text-left"
        >
          <div className="font-semibold text-lg mb-2">ğŸ‘´ Senior</div>
          <div className="text-sm text-gray-600">
            Wysokie rachunki, emerytura
            <br />
            <strong>Hak:</strong> OszczÄ™dnoÅ›ci 30%
          </div>
        </button>

        <button
          onClick={() => { setClientProfile('eco'); goToStage('opening', 'Profil: Åšwiadomy ekologicznie'); }}
          className="p-4 border-2 border-gray-300 rounded-lg hover:border-emerald-500 hover:bg-emerald-50 transition text-left"
        >
          <div className="font-semibold text-lg mb-2">ğŸŒ± Åšwiadomy Ekologicznie</div>
          <div className="text-sm text-gray-600">
            Ekologia, wartoÅ›Ä‡ nieruchomoÅ›ci
            <br />
            <strong>Hak:</strong> Åšlad wÄ™glowy + ROI
          </div>
        </button>

        <button
          onClick={() => { setClientProfile('skeptic'); goToStage('opening', 'Profil: Sceptyk'); }}
          className="p-4 border-2 border-gray-300 rounded-lg hover:border-orange-500 hover:bg-orange-50 transition text-left"
        >
          <div className="font-semibold text-lg mb-2">ğŸ¤” Sceptyk</div>
          <div className="text-sm text-gray-600">
            Nie wierzy w obietnice
            <br />
            <strong>Hak:</strong> Dowody, gwarancje, certyfikaty
          </div>
        </button>
      </div>
    </div>
  );

  const OpeningScreen = () => {
    const hooks = {
      family: "Pomagamy rodzinom pozbyÄ‡ siÄ™ problemu z wilgociÄ…, pleÅ›niÄ… i alergenami - szczegÃ³lnie waÅ¼ne dla dzieci z alergiÄ….",
      senior: "Pomagamy obniÅ¼yÄ‡ rachunki za ogrzewanie nawet o 30% - to Å›rednio 2000-3000 zÅ‚ oszczÄ™dnoÅ›ci rocznie.",
      eco: "Pomagamy zmniejszyÄ‡ Å›lad wÄ™glowy domu i zwiÄ™kszyÄ‡ jego wartoÅ›Ä‡ rynkowÄ… o 10-15%.",
      skeptic: "Realizujemy wÅ‚aÅ›nie projekty termomodernizacyjne w PaÅ„stwa okolicy z gwarancjÄ… efektywnoÅ›ci na piÅ›mie."
    };

    return (
      <div className="space-y-6">
        <div className="flex items-center justify-between">
          <h3 className="text-2xl font-bold">3. Otwarcie</h3>
          <span className="text-sm bg-gray-100 px-3 py-1 rounded-full">â±ï¸ 10-15 sekund</span>
        </div>

        <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded">
          <p className="font-semibold mb-2">ğŸ’¬ POWIEDZ:</p>
          <div className="bg-white p-4 rounded border border-green-200">
            {contactType === 'warm' ? (
              <p className="text-lg leading-relaxed">
                <strong>"DzieÅ„ dobry, nazywam siÄ™ [Twoje ImiÄ™] z firmy 4-eco. DzwoniÄ™ w sprawie programu Zdrowe Mieszkanie Plus. Czy to dobry moment na krÃ³tkÄ… rozmowÄ™?"</strong>
                <br /><br />
                [PAUZA - pozwÃ³l klientowi odpowiedzieÄ‡]
                <br /><br />
                {hooks[clientProfile]}
              </p>
            ) : (
              <p className="text-lg leading-relaxed">
                <strong>"DzieÅ„ dobry, mÃ³wi [Twoje ImiÄ™] z firmy 4-eco. Czy rozmawiam z Panem/PaniÄ… [Nazwisko]?"</strong>
                <br /><br />
                [Poczekaj na potwierdzenie]
                <br /><br />
                <strong>"Åšwietnie! DzwoniÄ™, poniewaÅ¼ aktualnie realizujemy w PaÅ„stwa rejonie program Zdrowe Mieszkanie Plus. {hooks[clientProfile]} Czy to dobry moment na 2-minutowÄ… rozmowÄ™?"</strong>
              </p>
            )}
          </div>
        </div>

        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
          <p className="font-semibold mb-2">âš ï¸ WSKAZÃ“WKA:</p>
          <ul className="text-sm space-y-1">
            <li>â€¢ UÅ›miechnij siÄ™ - sÅ‚ychaÄ‡ to przez telefon!</li>
            <li>â€¢ Poczekaj na odpowiedÅº klienta</li>
            <li>â€¢ JeÅ›li mÃ³wi "nie mam czasu" - przejdÅº do obiekcji</li>
            <li>â€¢ JeÅ›li zgadza siÄ™ - idÅº dalej do kwalifikacji</li>
          </ul>
        </div>

        <div className="space-y-3">
          <p className="font-semibold">Reakcja klienta:</p>
          <button
            onClick={() => goToStage('qualification', 'Klient zgodziÅ‚ siÄ™ na rozmowÄ™')}
            className="w-full p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition flex items-center justify-between"
          >
            <span>âœ… "Ok, mÃ³w" / "Tak, sÅ‚ucham"</span>
            <ChevronRight />
          </button>
          <button
            onClick={() => goToStage('objection-time', 'Obiekcja: Nie mam czasu')}
            className="w-full p-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition flex items-center justify-between"
          >
            <span>â° "Nie mam czasu"</span>
            <ChevronRight />
          </button>
          <button
            onClick={() => goToStage('objection-interest', 'Obiekcja: Nie interesuje mnie')}
            className="w-full p-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition flex items-center justify-between"
          >
            <span>âŒ "Nie interesuje mnie to"</span>
            <ChevronRight />
          </button>
        </div>
      </div>
    );
  };

  const QualificationScreen = () => (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h3 className="text-2xl font-bold">4. Kwalifikacja</h3>
        <span className="text-sm bg-gray-100 px-3 py-1 rounded-full">â±ï¸ 1-2 minuty</span>
      </div>

      <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
        <p className="font-semibold mb-2">ğŸ¯ CEL:</p>
        <p className="text-sm">Zbierz dane do kalkulatora: typ nieruchomoÅ›ci, metraÅ¼, problemy, rachunki</p>
      </div>

      <div className="space-y-4">
        <div>
          <label className="font-semibold mb-2 block">ğŸ“ Dane Klienta (wypeÅ‚niaj podczas rozmowy):</label>
          
          <div className="space-y-3 bg-white p-4 rounded-lg border">
            <input
              type="text"
              placeholder="ImiÄ™ i nazwisko"
              value={clientData.name}
              onChange={(e) => setClientData({...clientData, name: e.target.value})}
              className="w-full p-2 border rounded"
            />

            <div>
              <p className="text-sm font-semibold mb-2">ğŸ’¬ ZAPYTAJ: "Mieszkacie PaÅ„stwo w mieszkaniu czy w domu jednorodzinnym?"</p>
              <div className="flex gap-2">
                <button
                  onClick={() => setClientData({...clientData, propertyType: 'mieszkanie'})}
                  className={`flex-1 p-2 rounded border-2 ${clientData.propertyType === 'mieszkanie' ? 'border-green-500 bg-green-50' : 'border-gray-300'}`}
                >
                  ğŸ¢ Mieszkanie
                </button>
                <button
                  onClick={() => setClientData({...clientData, propertyType: 'dom'})}
                  className={`flex-1 p-2 rounded border-2 ${clientData.propertyType === 'dom' ? 'border-green-500 bg-green-50' : 'border-gray-300'}`}
                >
                  ğŸ  Dom
                </button>
              </div>
              {clientData.propertyType === 'dom' && (
                <div className="mt-2 p-2 bg-green-50 rounded text-sm">
                  âœ… <strong>ZANOTUJ:</strong> Dom = ulga termomodernizacyjna do 7300 zÅ‚!
                </div>
              )}
            </div>

            <div>
              <p className="text-sm font-semibold mb-2">ğŸ’¬ ZAPYTAJ: "Jaka jest mniej wiÄ™cej powierzchnia?"</p>
              <input
                type="number"
                placeholder="Powierzchnia w mÂ²"
                value={clientData.area}
                onChange={(e) => setClientData({...clientData, area: e.target.value})}
                className="w-full p-2 border rounded"
              />
              {clientData.area && (
                <div className="mt-2 p-2 bg-blue-50 rounded text-sm">
                  ğŸ’¡ <strong>POWIEDZ:</strong> "Ok, {clientData.area}mÂ² - to oznacza {calculations.rekuperatorCount} rekuperator{calculations.rekuperatorCount > 1 ? 'y' : ''} dla optymalnej wentylacji."
                </div>
              )}
            </div>

            <div>
              <p className="text-sm font-semibold mb-2">ğŸ’¬ ZAPYTAJ: "Ile mniej wiÄ™cej pÅ‚acÄ… PaÅ„stwo miesiÄ™cznie za ogrzewanie i prÄ…d?"</p>
              <input
                type="number"
                placeholder="Rachunki w zÅ‚/miesiÄ…c"
                value={clientData.monthlyBill}
                onChange={(e) => setClientData({...clientData, monthlyBill: e.target.value})}
                className="w-full p-2 border rounded"
              />
              {clientData.monthlyBill && (
                <div className="mt-2 p-2 bg-blue-50 rounded text-sm">
                  ğŸ’¡ <strong>POWIEDZ:</strong> "{clientData.monthlyBill} zÅ‚ miesiÄ™cznie, to daje {clientData.monthlyBill * 12} rocznie. System zaoszczÄ™dzi okoÅ‚o 30% - czyli {Math.round(calculations.savings)} zÅ‚ miesiÄ™cznie."
                </div>
              )}
            </div>

            <div>
              <p className="text-sm font-semibold mb-2">ğŸ’¬ ZAPYTAJ: "Czy borykajÄ… siÄ™ PaÅ„stwo z ktÃ³rymÅ› z tych problemÃ³w?"</p>
              <div className="space-y-2">
                {['Wysokie rachunki', 'WilgoÄ‡/pleÅ›Å„', 'Zapachy/dusznoÅ›Ä‡', 'Alergeny', 'NierÃ³wnomierna temperatura'].map(problem => (
                  <label key={problem} className="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
                    <input
                      type="checkbox"
                      checked={clientData.problems.includes(problem)}
                      onChange={(e) => {
                        if (e.target.checked) {
                          setClientData({...clientData, problems: [...clientData.problems, problem]});
                        } else {
                          setClientData({...clientData, problems: clientData.problems.filter(p => p !== problem)});
                        }
                      }}
                      className="w-4 h-4"
                    />
                    <span className="text-sm">{problem}</span>
                  </label>
                ))}
              </div>
            </div>
          </div>
        </div>

        {clientData.area && clientData.monthlyBill && (
          <button
            onClick={() => setShowCalculator(!showCalculator)}
            className="w-full p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition flex items-center justify-center gap-2"
          >
            <Calculator size={20} />
            {showCalculator ? 'Ukryj' : 'PokaÅ¼'} Kalkulator
          </button>
        )}

        {showCalculator && (
          <div className="bg-gradient-to-br from-green-50 to-blue-50 p-4 rounded-lg border-2 border-green-300">
            <h4 className="font-bold mb-3 flex items-center gap-2">
              <Calculator size={20} />
              Szybki Kalkulator
            </h4>
            <div className="grid grid-cols-2 gap-3 text-sm">
              <div className="bg-white p-3 rounded">
                <div className="text-gray-600">Rekuperatory</div>
                <div className="text-xl font-bold">{calculations.rekuperatorCount} szt.</div>
                <div className="text-xs text-gray-500">{calculations.rekuperatorCost.toFixed(0)} zÅ‚</div>
              </div>
              <div className="bg-white p-3 rounded">
                <div className="text-gray-600">Farba PSC</div>
                <div className="text-xl font-bold">{calculations.pscLiters.toFixed(0)} L</div>
                <div className="text-xs text-gray-500">{calculations.pscCost.toFixed(0)} zÅ‚</div>
              </div>
              <div className="bg-white p-3 rounded">
                <div className="text-gray-600">KOMFORT</div>
                <div className="text-xl font-bold text-green-600">{calculations.totalKomfort.toFixed(0)} zÅ‚</div>
                <div className="text-xs text-gray-500">z montaÅ¼em</div>
              </div>
              <div className="bg-white p-3 rounded">
                <div className="text-gray-600">OszczÄ™dnoÅ›ci</div>
                <div className="text-xl font-bold text-blue-600">{Math.round(calculations.savings)} zÅ‚/mc</div>
                <div className="text-xs text-gray-500">{Math.round(calculations.annualSavings)} zÅ‚/rok</div>
              </div>
              <div className="bg-white p-3 rounded col-span-2">
                <div className="text-gray-600">Zwrot inwestycji (ROI)</div>
                <div className="text-2xl font-bold text-purple-600">{calculations.roi.toFixed(1)} lat</div>
                <div className="text-xs text-gray-500">PÃ³Åºniej czyste oszczÄ™dnoÅ›ci przez 15+ lat</div>
              </div>
            </div>
          </div>
        )}

        <button
          onClick={() => goToStage('presentation', 'PrzejÅ›cie do prezentacji')}
          className="w-full p-4 bg-green-500 text-white rounded-lg hover:bg-green-600 transition flex items-center justify-between text-lg font-semibold"
        >
          <span>PrzejdÅº do Prezentacji</span>
          <ChevronRight size={24} />
        </button>
      </div>
    </div>
  );

  const PresentationScreen = () => {
    const mainProblem = clientData.problems[0] || 'Wysokie rachunki';
    
    return (
      <div className="space-y-6">
        <div className="flex items-center justify-between">
          <h3 className="text-2xl font-bold">5. Prezentacja</h3>
          <span className="text-sm bg-gray-100 px-3 py-1 rounded-full">â±ï¸ 2-3 minuty</span>
        </div>

        <div className="bg-purple-50 border-l-4 border-purple-500 p-4 rounded">
          <p className="font-semibold mb-2">ğŸ¯ FOKUS:</p>
          <p className="text-sm">GÅ‚Ã³wny problem klienta: <strong>{mainProblem}</strong></p>
        </div>

        <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded">
          <p className="font-semibold mb-2">ğŸ’¬ POWIEDZ:</p>
          <div className="bg-white p-4 rounded border border-green-200 space-y-4">
            <p className="leading-relaxed">
              <strong>"Ok {clientData.name ? clientData.name.split(' ')[0] : 'Panie/Pani'}, wiÄ™c bazujÄ…c na tym co Pan/Pani powiedziaÅ‚ - {clientData.propertyType} {clientData.area}mÂ², rachunki okoÅ‚o {clientData.monthlyBill} zÅ‚otych miesiÄ™cznie - mam dla PaÅ„stwa rozwiÄ…zanie."</strong>
            </p>

            <div className="border-t pt-4">
              <p className="font-semibold mb-2">ğŸ“¦ PAKIET KOMFORT</p>
              <ul className="space-y-2 ml-4">
                <li className="leading-relaxed">
                  <strong>1. Farba termoizolacyjna PSC Interior</strong> - to nie zwykÅ‚a farba. Ma ceramiczne mikrosfery, ktÃ³re odbijajÄ… ciepÅ‚o z powrotem do pokoju. Efekt? <span className="bg-yellow-200 px-1">Plus 2 stopnie cieplej bez dodatkowych kosztÃ³w ogrzewania</span>. Badania potwierdzajÄ… - +2Â°C odczuwalne.
                </li>
                <li className="leading-relaxed">
                  <strong>2. {calculations.rekuperatorCount} rekuperator{calculations.rekuperatorCount > 1 ? 'y' : ''} EasyEko</strong> - inteligentna wentylacja. Wypuszcza stare powietrze, wpuszcza Å›wieÅ¼e, ale... <span className="bg-yellow-200 px-1">odzyskuje 90% ciepÅ‚a!</span> Efekt? ÅšwieÅ¼e powietrze bez strat energii. Plus filtry HEPA - zatrzymujÄ… 99,9% alergenÃ³w.
                </li>
                <li className="leading-relaxed">
                  <strong>3. PeÅ‚ny montaÅ¼</strong> - wszystko pod klucz, 1-2 dni robÃ³t, gwarancja 5 lat.
                </li>
              </ul>
            </div>

            {clientData.area && clientData.monthlyBill && (
              <div className="border-t pt-4 bg-blue-50 p-3 rounded">
                <p className="font-semibold mb-2">ğŸ’° KOSZTY I OSZCZÄ˜DNOÅšCI:</p>
                <ul className="space-y-1 text-sm">
                  <li>â€¢ Koszt caÅ‚oÅ›ci: okoÅ‚o <strong className="text-lg">{calculations.totalKomfort.toFixed(0)} zÅ‚</strong></li>
                  <li>â€¢ OszczÄ™dnoÅ›ci: <strong className="text-lg text-green-600">{Math.round(calculations.savings)} zÅ‚ miesiÄ™cznie</strong> (30%)</li>
                  <li>â€¢ Rocznie: <strong className="text-lg text-green-600">{Math.round(calculations.annualSavings)} zÅ‚</strong></li>
                  <li>â€¢ Zwrot inwestycji: <strong className="text-lg text-purple-600">{calculations.roi.toFixed(1)} lat</strong></li>
                  <li className="pt-2 border-t">â€¢ System dziaÅ‚a 20 lat = <strong className="text-xl text-blue-600">{Math.round((20 - calculations.roi) * calculations.annualSavings).toFixed(0)} zÅ‚</strong> czystych oszczÄ™dnoÅ›ci!</li>
                </ul>
              </div>
            )}

            <p className="leading-relaxed pt-4 border-t">
              <strong>"To nie koszt - to inwestycja, ktÃ³ra siÄ™ spÅ‚aca. Pytanie brzmi: czy niÅ¼sze rachunki i zdrowsze powietrze sÄ… dla PaÅ„stwa waÅ¼ne?"</strong>
            </p>
          </div>
        </div>

        <div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
          <p className="font-semibold mb-2">ğŸ’¡ WSKAZÃ“WKA:</p>
          <ul className="text-sm space-y-1">
            <li>â€¢ MÃ³w wolno, z pauzami</li>
            <li>â€¢ PodkreÅ›laj konkretne liczby</li>
            <li>â€¢ Czekaj na reakcjÄ™ klienta</li>
            <li>â€¢ Nie przytÅ‚aczaj szczegÃ³Å‚ami technicznymi</li>
          </ul>
        </div>

        <div className="space-y-3">
          <p className="font-semibold">Reakcja klienta:</p>
          <button
            onClick={() => goToStage('closing', 'Klient zainteresowany - przejÅ›cie do zamkniÄ™cia')}
            className="w-full p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition flex items-center justify-between"
          >
            <span>âœ… "Brzmi ciekawie" / "Jak to dziaÅ‚a?"</span>
            <ChevronRight />
          </button>
          <button
            onClick={() => goToStage('objection-price', 'Obiekcja: To za drogie')}
            className="w-full p-3 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition flex items-center justify-between"
          >
            <span>ğŸ’° "To za drogie"</span>
            <ChevronRight />
          </button>
          <button
            onClick={() => goToStage('objection-belief', 'Obiekcja: Nie wierzÄ™ w oszczÄ™dnoÅ›ci')}
            className="w-full p-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition flex items-center justify-between"
          >
            <span>âŒ "Nie wierzÄ™ w te oszczÄ™dnoÅ›ci"</span>
            <ChevronRight />
          </button>
          <button
            onClick={() => goToStage('objection-think', 'Obiekcja: MuszÄ™ pomyÅ›leÄ‡')}
            className="w-full p-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition flex items-center justify-between"
          >
            <span>ğŸ¤” "MuszÄ™ pomyÅ›leÄ‡"</span>
            <ChevronRight />
          </button>
        </div>
      </div>
    );
  };

  const ObjectionScreen = ({ type }) => {
    const objections = {
      'objection-time': {
        title: 'Obiekcja: "Nie mam czasu"',
        responses: [
          {
            label: 'ODPOWIEDÅ¹ #1: Konkretne opcje',
            text: '"Rozumiem! Kiedy byÅ‚by lepszy moment? MogÄ™ zadzwoniÄ‡ dziÅ› wieczorem o 19:00 lub jutro rano o 10:00?"',
            tip: 'Zawsze daj konkretne opcje czasu, nie pytaj "kiedy"'
          },
          {
            label: 'ODPOWIEDÅ¹ #2: 60 sekund',
            text: '"Rozumiem. ZajmÄ™ Panu/Pani dosÅ‚ownie 60 sekund, Å¼eby powiedzieÄ‡ o czym to jest. JeÅ›li uzna Pan/Pani Å¼e to bez sensu - siÄ™ rozÅ‚Ä…czymy. Zgoda?"',
            tip: 'JeÅ›li zgodzi siÄ™ - bardzo skrÃ³cona wersja haka'
          }
        ],
        actions: ['UmÃ³w konkretny termin', 'Daj 60-sekundowy pitch', 'PodziÄ™kuj i zakoÅ„cz']
      },
      'objection-interest': {
        title: 'Obiekcja: "Nie interesuje mnie to"',
        responses: [
          {
            label: 'ODPOWIEDÅ¹: Reframing',
            text: '"Rozumiem. MogÄ™ zapytaÄ‡ - co konkretnie Pana/PaniÄ… nie interesuje? OszczÄ™dnoÅ›ci na rachunkach czy poprawa jakoÅ›ci powietrza?"',
            tip: 'Klient prawie zawsze odpowie - to otwiera na rozmowÄ™'
          }
        ],
        actions: ['SÅ‚uchaj odpowiedzi', 'Adresuj konkretny punkt', 'JeÅ›li dalej nie - grzecznie zakoÅ„cz']
      },
      'objection-price': {
        title: 'Obiekcja: "To za drogie"',
        responses: [
          {
            label: 'ODPOWIEDÅ¹ #1: Feel-Felt-Found',
            text: `"Rozumiem to uczucie. Wielu naszych klientÃ³w czuÅ‚o to samo na poczÄ…tku. Ale kiedy pokazaÅ‚em im, Å¼e pÅ‚acÄ… ${clientData.monthlyBill || 'X'} zÅ‚otych miesiÄ™cznie, czyli ${(clientData.monthlyBill || 0) * 12} rocznie, i Å¼e system zaoszczÄ™dzi ${Math.round(calculations.annualSavings) || 'Y'} rocznie - zrozumieli, Å¼e to nie wydatek, to inwestycja ktÃ³ra siÄ™ spÅ‚aca."`,
            tip: 'Technika "CzujÄ™-CzuÅ‚-ZnalazÅ‚" buduje empatiÄ™'
          },
          {
            label: 'ODPOWIEDÅ¹ #2: Rozbicie na maÅ‚e kwoty',
            text: `"Rozumiem. To ${calculations.totalKomfort ? calculations.totalKomfort.toFixed(0) : 'X'} zÅ‚ na 20 lat. To ${calculations.totalKomfort ? Math.round(calculations.totalKomfort / 20 / 12) : 'Y'} zÅ‚ miesiÄ™cznie. Mniej niÅ¼ koszt kawy na wynos kaÅ¼dego dnia. A oszczÄ™dnoÅ›ci? ${Math.round(calculations.savings) || 'Z'} zÅ‚ miesiÄ™cznie. System pÅ‚aci za siebie!"`,
            tip: 'Rozbij duÅ¼Ä… kwotÄ™ na maÅ‚e, miesiÄ™czne'
          },
          {
            label: 'ODPOWIEDÅ¹ #3: Kredyt',
            text: `"Rozumiem. Dlatego mamy kredyt w Alior Bank - rata okoÅ‚o ${Math.round(calculations.totalKomfort / 60) || '200'} zÅ‚ miesiÄ™cznie przez 5 lat. OszczÄ™dza Pan/Pani ${Math.round(calculations.savings) || '150'} zÅ‚, pÅ‚aci ratÄ™ ${Math.round(calculations.totalKomfort / 60) || '200'} = realny koszt ${Math.round((calculations.totalKomfort / 60) - calculations.savings) || '50'} zÅ‚ miesiÄ™cznie. Czy zdrowie jest warte ${Math.round((calculations.totalKomfort / 60) - calculations.savings) || '50'} zÅ‚?"`,
            tip: 'Pokaz Å¼e rata < oszczÄ™dnoÅ›ci'
          }
        ],
        actions: ['PrzejdÅº do zamkniÄ™cia', 'Zaproponuj spotkanie', 'WyÅ›lij kalkulacjÄ™ mailowo']
      },
      'objection-belief': {
        title: 'Obiekcja: "Nie wierzÄ™ w oszczÄ™dnoÅ›ci"',
        responses: [
          {
            label: 'ODPOWIEDÅ¹: Dowody',
            text: '"Rozumiem sceptycyzm! Gdybym byÅ‚ na Pana/Pani miejscu, teÅ¼ bym miaÅ‚ wÄ…tpliwoÅ›ci. Dlatego nie proszÄ™ Å¼eby mi Pan/Pani wierzyÅ‚ na sÅ‚owo. Mam konkretne dane: Audyt paÅ„stwa Kowalskich - przed: 680 zÅ‚/mc, po: 470 zÅ‚/mc. Certyfikat TÃœV NORD dla farby - niezaleÅ¼ne badania +2Â°C. Plus gwarancja efektywnoÅ›ci - jeÅ›li oszczÄ™dnoÅ›ci <20%, zwracamy rÃ³Å¼nicÄ™."',
            tip: 'Konkretne liczby + dowody + gwarancja'
          }
        ],
        actions: ['Zaproponuj darmowÄ… diagnozÄ™', 'PokaÅ¼ certyfikaty', 'PrzejdÅº do zamkniÄ™cia']
      },
      'objection-think': {
        title: 'Obiekcja: "MuszÄ™ pomyÅ›leÄ‡"',
        responses: [
          {
            label: 'ODPOWIEDÅ¹ #1: Odkryj prawdziwÄ… obiekcjÄ™',
            text: '"OczywiÅ›cie, to caÅ‚kowicie zrozumiaÅ‚e! Ale pozwoli Pan/Pani na jedno pytanie - zazwyczaj gdy ktoÅ› mÃ³wi \'muszÄ™ pomyÅ›leÄ‡\', to znaczy Å¼e coÅ› go niepokoi. Czy to kwestia ceny, czy moÅ¼e wÄ…tpliwoÅ›ci czy to dziaÅ‚a, czy coÅ› innego?"',
            tip: 'MILCZ i sÅ‚uchaj. Klient ujawni prawdziwÄ… obiekcjÄ™'
          },
          {
            label: 'ODPOWIEDÅ¹ #2: UmÃ³w spotkanie',
            text: '"Åšwietnie! Zastanowienie to mÄ…dra decyzja. Powiem tak - mam jeszcze kilka wolnych terminÃ³w w tym tygodniu. MogÄ™ zarezerwowaÄ‡ spotkanie diagnostyczne - jutro o 16:00 lub piÄ…tek o 10:00. Zobaczy Pan/Pani dokÅ‚adne wyliczenia, i wtedy w spokoju podejmie decyzjÄ™. KtÃ³ry termin bardziej pasuje?"',
            tip: 'Alternatywne zamkniÄ™cie: A czy B, nie tak/nie'
          }
        ],
        actions: ['Odkryj prawdziwÄ… obiekcjÄ™', 'UmÃ³w spotkanie', 'WyÅ›lij materiaÅ‚y + follow-up']
      }
    };

    const objection = objections[type] || objections['objection-time'];

    return (
      <div className="space-y-6">
        <div className="flex items-center justify-between">
          <h3 className="text-2xl font-bold text-orange-600">{objection.title}</h3>
          <AlertCircle className="text-orange-500" size={32} />
        </div>

        <div className="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
          <p className="font-semibold mb-2">âš ï¸ PAMIÄ˜TAJ:</p>
          <p className="text-sm">Obiekcje to normalne! Nie oznaczajÄ… "nie" - oznaczajÄ… "potrzebujÄ™ wiÄ™cej informacji".</p>
        </div>

        {objection.responses.map((response, idx) => (
          <div key={idx} className="bg-green-50 border-l-4 border-green-500 p-4 rounded">
            <p className="font-semibold mb-2">{response.label}</p>
            <div className="bg-white p-4 rounded border border-green-200 mb-2">
              <p className="leading-relaxed">{response.text}</p>
            </div>
            <div className="bg-yellow-50 p-2 rounded text-sm">
              ğŸ’¡ <strong>WskazÃ³wka:</strong> {response.tip}
            </div>
          </div>
        ))}

        <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
          <p className="font-semibold mb-2">ğŸ“‹ MOÅ»LIWE AKCJE:</p>
          <ul className="text-sm space-y-1">
            {objection.actions.map((action, idx) => (
              <li key={idx}>â€¢ {action}</li>
            ))}
          </ul>
        </div>

        <div className="grid grid-cols-2 gap-3">
          <button
            onClick={() => goToStage('closing', 'Obiekcja obsÅ‚uÅ¼ona - przejÅ›cie do zamkniÄ™cia')}
            className="p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
          >
            âœ… ObsÅ‚uÅ¼one - Do ZamkniÄ™cia
          </button>
          <button
            onClick={() => goToStage('presentation', 'PowrÃ³t do prezentacji')}
            className="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
          >
            ğŸ”„ WrÃ³Ä‡ do Prezentacji
          </button>
        </div>
      </div>
    );
  };

  const ClosingScreen = () => (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h3 className="text-2xl font-bold text-green-600">6. ZamkniÄ™cie</h3>
        <Target className="text-green-500" size={32} />
      </div>

      <div className="bg-green-50 border-l-4 border-green-500 p-4 rounded">
        <p className="font-semibold mb-2">ğŸ¯ CEL:</p>
        <p className="text-sm">UmÃ³wiÄ‡ spotkanie diagnostyczne lub wysÅ‚aÄ‡ materiaÅ‚y z konkretnym follow-up</p>
      </div>

      <div className="space-y-4">
        <div className="bg-white border-2 border-green-300 rounded-lg p-4">
          <h4 className="font-bold text-lg mb-3 flex items-center gap-2">
            <CheckCircle className="text-green-500" />
            ZAMKNIÄ˜CIE #1: Twarde (klient gorÄ…cy)
          </h4>
          <div className="bg-green-50 p-3 rounded mb-3">
            <p className="leading-relaxed">
              <strong>"Åšwietnie! WidzÄ™ Å¼e system Zdrowe Mieszkanie+ mÃ³gÅ‚by byÄ‡ idealny dla PaÅ„stwa. NastÄ™pny krok to darmowe spotkanie diagnostyczne - nasz konsultant przyjdzie z kamerÄ… termowizyjnÄ…, zmierzymy dokÅ‚adnie straty energii i przygotujemy spersonalizowanÄ… ofertÄ™."</strong>
              <br /><br />
              <strong>"Mam wolne terminy jutro o 16:00 lub w piÄ…tek o 10:00. KtÃ³ry termin bardziej PaÅ„stwu pasuje?"</strong>
            </p>
          </div>
          <div className="bg-yellow-50 p-2 rounded text-sm">
            ğŸ’¡ Nie pytaj "czy chce Pan spotkanie" - zakÅ‚adaj Å¼e chce. Daj wybÃ³r miÄ™dzy A a B!
          </div>
        </div>

        <div className="bg-white border-2 border-blue-300 rounded-lg p-4">
          <h4 className="font-bold text-lg mb-3 flex items-center gap-2">
            <MessageSquare className="text-blue-500" />
            ZAMKNIÄ˜CIE #2: MiÄ™kkie (klient ostroÅ¼ny)
          </h4>
          <div className="bg-blue-50 p-3 rounded mb-3">
            <p className="leading-relaxed">
              <strong>"Rozumiem, to duÅ¼a decyzja. ZrÃ³bmy tak:"</strong>
              <br /><br />
              â€¢ Krok 1 - WyÅ›lÄ™ PaÅ„stwu mailowo kalkulator z wyliczeniami dla PaÅ„stwa {clientData.propertyType} {clientData.area}mÂ²
              <br />
              â€¢ Krok 2 - ZadzwoniÄ™ za 2-3 dni, odpowiem na pytania
              <br />
              â€¢ Krok 3 - JeÅ›li uznacie Å¼e ma sens - umÃ³wimy spotkanie
              <br /><br />
              <strong>"Brzmi dobrze? Jaki jest PaÅ„stwa adres email?"</strong>
            </p>
          </div>
        </div>

        <div className="bg-white border-2 border-gray-300 rounded-lg p-4">
          <h4 className="font-bold text-lg mb-3 flex items-center gap-2">
            <Clock className="text-gray-500" />
            ZAMKNIÄ˜CIE #3: Awaryjne (klient zimny)
          </h4>
          <div className="bg-gray-50 p-3 rounded mb-3">
            <p className="leading-relaxed">
              <strong>"Rozumiem, to nie jest dobry moment. Nie ma sprawy."</strong>
              <br /><br />
              <strong>"Zapisze Pan/Pani mÃ³j numer? +48 502 963 879. JeÅ›li kiedyÅ› pojawiÄ… siÄ™ problemy z wilgociÄ…, wysokimi rachunkami lub jakoÅ›ciÄ… powietrza - zadzwoÅ„cie. PomogÄ™ bez zobowiÄ…zaÅ„."</strong>
              <br /><br />
              <strong>"MogÄ™ zadzwoniÄ‡ za 3-6 miesiÄ™cy, Å¼eby sprawdziÄ‡ czy sytuacja siÄ™ zmieniÅ‚a? Tylko przypomnienie, zero presji."</strong>
            </p>
          </div>
        </div>
      </div>

      <div className="bg-gradient-to-r from-green-500 to-blue-500 text-white p-6 rounded-lg">
        <h4 className="font-bold text-xl mb-3">ğŸ“ PO ROZMOWIE - CHECKLIST:</h4>
        <div className="space-y-2 text-sm">
          <label className="flex items-center gap-2">
            <input type="checkbox" className="w-4 h-4" />
            <span>Zanotuj wynik w CRM</span>
          </label>
          <label className="flex items-center gap-2">
            <input type="checkbox" className="w-4 h-4" />
            <span>WyÅ›lij SMS/email z potwierdzeniem (jeÅ›li umÃ³wiono spotkanie)</span>
          </label>
          <label className="flex items-center gap-2">
            <input type="checkbox" className="w-4 h-4" />
            <span>Zaplanuj follow-up (2-7 dni)</span>
          </label>
          <label className="flex items-center gap-2">
            <input type="checkbox" className="w-4 h-4" />
            <span>Przeanalizuj co zadziaÅ‚aÅ‚o / co poprawiÄ‡</span>
          </label>
        </div>
      </div>

      <button
        onClick={() => {
          if (window.confirm('Czy chcesz rozpoczÄ…Ä‡ nowÄ… rozmowÄ™? Obecne dane zostanÄ… utracone.')) {
            setStage('start');
            setClientData({ name: '', propertyType: '', area: '', monthlyBill: '', problems: [] });
            setNotes('');
            setHistory([]);
            addToHistory('RozpoczÄ™to nowÄ… rozmowÄ™');
          }
        }}
        className="w-full p-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition flex items-center justify-center gap-2 text-lg font-bold"
      >
        <RefreshCw size={24} />
        Rozpocznij NowÄ… RozmowÄ™
      </button>
    </div>
  );

  // RENDER
  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50 p-4">
      <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-3">
              <Phone className="text-green-600" size={32} />
              <div>
                <h1 className="text-2xl font-bold">Interaktywny Skrypt Rozmowy</h1>
                <p className="text-gray-600 text-sm">Zdrowe Mieszkanie+ by 4-eco</p>
              </div>
            </div>
            {clientData.name && (
              <div className="text-right">
                <div className="text-sm text-gray-600">Klient:</div>
                <div className="font-bold">{clientData.name || 'Brak danych'}</div>
              </div>
            )}
          </div>

          {/* Progress bar */}
          {stage !== 'start' && (
            <div className="flex items-center gap-2 text-xs">
              <div className={`px-2 py-1 rounded ${['profile', 'opening', 'qualification', 'presentation', 'closing'].includes(stage) || stage.includes('objection') ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>
                Profil
              </div>
              <ChevronRight size={16} className="text-gray-400" />
              <div className={`px-2 py-1 rounded ${['opening', 'qualification', 'presentation', 'closing'].includes(stage) || stage.includes('objection') ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>
                Otwarcie
              </div>
              <ChevronRight size={16} className="text-gray-400" />
              <div className={`px-2 py-1 rounded ${['qualification', 'presentation', 'closing'].includes(stage) || stage.includes('objection') ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>
                Kwalifikacja
              </div>
              <ChevronRight size={16} className="text-gray-400" />
              <div className={`px-2 py-1 rounded ${['presentation', 'closing'].includes(stage) || stage.includes('objection') ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>
                Prezentacja
              </div>
              <ChevronRight size={16} className="text-gray-400" />
              <div className={`px-2 py-1 rounded ${stage === 'closing' ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>
                ZamkniÄ™cie
              </div>
            </div>
          )}
        </div>

        {/* Main Content */}
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          {stage === 'start' && <StartScreen />}
          {stage === 'profile' && <ProfileScreen />}
          {stage === 'opening' && <OpeningScreen />}
          {stage === 'qualification' && <QualificationScreen />}
          {stage === 'presentation' && <PresentationScreen />}
          {stage.includes('objection') && <ObjectionScreen type={stage} />}
          {stage === 'closing' && <ClosingScreen />}
        </div>

        {/* Notes & History Sidebar */}
        <div className="grid md:grid-cols-2 gap-6">
          <div className="bg-white rounded-lg shadow-lg p-4">
            <h3 className="font-bold mb-3 flex items-center gap-2">
              <MessageSquare size={20} />
              Notatki
            </h3>
            <textarea
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              placeholder="Zapisuj waÅ¼ne informacje z rozmowy..."
              className="w-full h-32 p-3 border rounded-lg resize-none text-sm"
            />
          </div>

          <div className="bg-white rounded-lg shadow-lg p-4">
            <h3 className="font-bold mb-3 flex items-center gap-2">
              <Clock size={20} />
              Historia Rozmowy
            </h3>
            <div className="space-y-2 max-h-32 overflow-y-auto">
              {history.length === 0 ? (
                <p className="text-sm text-gray-400">Brak historii</p>
              ) : (
                history.map((item, idx) => (
                  <div key={idx} className="text-xs bg-gray-50 p-2 rounded">
                    <span className="text-gray-500">{item.time}</span> - {item.action}
                  </div>
                ))
              )}
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="mt-6 text-center text-sm text-gray-600">
          <p>ğŸ“§ seweryn.kolodziej@4-eco.pl | ğŸ“± +48 502 963 879 | ğŸŒ www.4-eco.pl</p>
        </div>
      </div>
    </div>
  );
};

export default InteractiveCallScript;
